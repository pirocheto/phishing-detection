stages:

  download_data:
    cmd: wget ${data_url} -O ${path.data_all}
    params: 
      - data_url
      - path.data_all
    deps:
      - ${data_url}
    outs:
      - ${path.data_all}

  split_data:
    cmd: python src/split_data.py
    params: 
      - train_test_split
      - column_mapping
      - path.data_all
      - path.data_train
      - path.data_test
      - path.data_proportion
      - plt_style
    deps:
      - src/split_data.py
      - src/plots/data_proportion.py
      - ${path.data_all}
    plots:
      - ${path.data_proportion}:
          cache: False
    outs:
      - ${path.data_train}
      - ${path.data_test}

  train_model:
    cmd: python src/train_model.py
    params: 
      - path.data_train
      - column_mapping
      - pipeline
      - path.model_bin
    deps:
      - src/train_model.py
      - ${path.data_train}
    outs:
      - ${path.model_bin}

  test_model:
    cmd: 
      - python src/test_model.py
    params: 
      - path.data_test
      - path.data_train
      - column_mapping
      - path.model_bin
      - path.data_train_pred
      - path.data_test_pred
      - path.metrics
      - path.confusion_matrix
      - path.roc_curve
      - path.score_distribution
      - plt_style
    deps:
      - src/test_model.py
      - src/plots/confusion_matrix.py
      - src/plots/roc_curve.py
      - src/plots/score_distribution.py
      - ${path.data_test}
      - ${path.model_bin}
    plots:
      - ${path.confusion_matrix}:
          cache: False
      - ${path.roc_curve}:
          cache: False
      - ${path.score_distribution}:
          cache: False
    outs:
      - ${path.data_test_pred}:
          cache: False
      - ${path.data_train_pred}:
          cache: False
    metrics:
      - ${path.metrics}:
          cache: False

    
  feature_importances:
    cmd:
      - python src/feature_importances.py
    params: 
      - path.data_test
      - path.data_train
      - column_mapping
      - path.model_bin
      - path.feature_importances
      - plt_style
    deps:
      - src/feature_importances.py
      - src/plots/feature_importances.py
      - ${path.data_test}
      - ${path.model_bin}
    plots:
      - ${path.feature_importances}:
          cache: False


  # model_card:
  #   cmd: 
  #     - python src/model_card.py
  #   params:
  #     - data_train_pred
  #     - data_test_pred
  #     - feature_importance
  #     - metrics
  #     - column_mapping.target
  #     - column_mapping.pos_label
  #     - model_card
  #   deps:
  #     - src/model_card.py
  #     - src/plots
  #     - ${data_train_pred}
  #     - ${data_test_pred}
  #     - ${feature_importance}
  #   outs:
  #     - ${model_card}:
  #         cache: False