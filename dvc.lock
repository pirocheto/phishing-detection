schema: '2.0'
stages:
  download_data:
    cmd:
    - wget -q 
      https://raw.githubusercontent.com/pirocheto/dataset-registry/master/phishing-detection/data/dataset_B_05_2020.csv
      -O data/all.csv
    deps:
    - path: 
        https://raw.githubusercontent.com/pirocheto/dataset-registry/master/phishing-detection/data/dataset_B_05_2020.csv
      hash: md5
      checksum: '"6dbb847da1445c6e0bbdd4384878a6415cbeb462afe134c88ba4492e0e6c0c13"'
      size: 3661166
    params:
      params.yaml:
        data_url: 
          https://raw.githubusercontent.com/pirocheto/dataset-registry/master/phishing-detection/data/dataset_B_05_2020.csv
        path.data.all: data/all.csv
    outs:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
  report_data:
    cmd: python src/report_data.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/report_data.py
      hash: md5
      md5: 2d478369251db1be45153e2ebb8c8bd2
      size: 465
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        data_all: data/all.csv
        report_data_html: results/reports/data_report.html
    outs:
    - path: results/reports/data_report.html
      hash: md5
      md5: ccb49a64672738756090068cf4faa440
      size: 6170406
  split_data:
    cmd: python src/split_data.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/split_data.py
      hash: md5
      md5: 3e7c9daeaf22fc2653f705b0ed0a30ab
      size: 2549
    params:
      params.yaml:
        column_mapping:
          feature: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        path.data.all: data/all.csv
        path.data.raw:
          dir: data/raw
          train: data/raw/train.csv
          test: data/raw/test.csv
        path.results.plots.data_proportion: results/plots/data_proportion.png
        plt_style: Solarize_Light2
        train_test_split:
          test_size: 0.33
          random_state: 42
          shuffle: true
    outs:
    - path: data/raw
      hash: md5
      md5: 000b75bf48947366c86809a20fe811e5.dir
      size: 824540
      nfiles: 2
    - path: results/plots/data_proportion.png
      hash: md5
      md5: dbddd8db4d07822963af055209836a3b
      size: 20127
  train_model:
    cmd: python src/train_model.py
    deps:
    - path: data/raw
      hash: md5
      md5: 000b75bf48947366c86809a20fe811e5.dir
      size: 824540
      nfiles: 2
    - path: results/models/preprocessor.pkl
      hash: md5
      md5: 8d8536634de2db4ecd5ff15db78e7e9b
      size: 5798649
    - path: src/train_model.py
      hash: md5
      md5: a0f87fef79455118adb2e4edf3e44ee4
      size: 1430
    params:
      params.yaml:
        classifier:
          estimator:
            _target_: sklearn.svm.LinearSVC
            dual: auto
            C: 50
          cv: 5
          _target_: sklearn.calibration.CalibratedClassifierCV
          method: isotonic
        column_mapping:
          feature: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        path.data.raw:
          dir: data/raw
          train: data/raw/train.csv
          test: data/raw/test.csv
        path.results.models:
          dir: results/models
          label_encoder: results/models/label_encoder.pkl
          preprocessor: results/models/preprocessor.pkl
          classifier: results/models/classifier.pkl
    outs:
    - path: results/models/classifier.pkl
      hash: md5
      md5: 43f86bf775c9ff758f527920e3858028
      size: 7991239
  test_model:
    cmd: python src/test_model.py
    deps:
    - path: data/raw
      hash: md5
      md5: 000b75bf48947366c86809a20fe811e5.dir
      size: 824540
      nfiles: 2
    - path: results/models
      hash: md5
      md5: 4e97e91f93d33dcc5e08c4c91dac9cca.dir
      size: 13790154
      nfiles: 3
    - path: src/test_model.py
      hash: md5
      md5: dfad96c92fd4860362342ec63785d00b
      size: 16450
    params:
      params.yaml:
        column_mapping:
          feature: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        path.data.predicted:
          dir: data/predicted
          train: data/predicted/train.csv
          test: data/predicted/test.csv
        path.data.raw:
          dir: data/raw
          train: data/raw/train.csv
          test: data/raw/test.csv
        path.results.classification_report: results/classification_report.png
        path.results.metrics: results/metrics.yaml
        path.results.models:
          dir: results/models
          label_encoder: results/models/label_encoder.pkl
          preprocessor: results/models/preprocessor.pkl
          classifier: results/models/classifier.pkl
        path.results.plots.calibration_curve: results/plots/calibration_curve.png
        path.results.plots.confusion_matrix: results/plots/confusion_matrix.png
        path.results.plots.cumulative_distribution: results/plots/cumulative_distribution.png
        path.results.plots.metrics_table: results/plots/metrics_table.png
        path.results.plots.precision_recall_curve: results/plots/precision_recall_curve.png
        path.results.plots.roc_curve: results/plots/roc_curve.png
        path.results.plots.score_distribution: results/plots/score_distribution.png
        plt_style: Solarize_Light2
    outs:
    - path: data/predicted
      hash: md5
      md5: 3f1d15b446b994447d9d21756f0812be.dir
      size: 999952
      nfiles: 2
    - path: results/classification_report.png
      hash: md5
      md5: 73aae7451c2b0ebb57ac53a67d18127f
      size: 109757
    - path: results/metrics.yaml
      hash: md5
      md5: 8a0496ae2eac355880205bd3cccfd901
      size: 199
    - path: results/plots/calibration_curve.png
      hash: md5
      md5: 3c6f3f497ff9f05f8038706acdb0edc5
      size: 29338
    - path: results/plots/confusion_matrix.png
      hash: md5
      md5: b9ca4430022c7cb46464b067accc3cfe
      size: 12389
    - path: results/plots/cumulative_distribution.png
      hash: md5
      md5: 9aad915b6830dce484f594dc64486ec9
      size: 32386
    - path: results/plots/metrics_table.png
      hash: md5
      md5: 61599ae90e8fbb6baa7c9ec567e8da21
      size: 13733
    - path: results/plots/precision_recall_curve.png
      hash: md5
      md5: 449db47eb9ea0e8bc9ad7400217e9e42
      size: 22119
    - path: results/plots/roc_curve.png
      hash: md5
      md5: 3ef3c299b626025e09e2b27e7a73f3a9
      size: 34865
    - path: results/plots/score_distribution.png
      hash: md5
      md5: 6f1aa70f2f05249d36bd7aef11a1ecff
      size: 19288
  dag:
    cmd: dvc dag --md > dag.md
  create_model_card:
    cmd:
    - python src/model_card.py
    deps:
    - path: data/test_pred.csv
      hash: md5
      md5: cfea1064c4b01d66303795adeb32fe53
      size: 1310300
    - path: data/train_pred.csv
      hash: md5
      md5: 8a68d662b9c6a5b627872181dfc1ff57
      size: 2667246
    - path: results/feature_importance.yaml
      hash: md5
      md5: fa7c581d0a8236870eafb42f3f781ec7
      size: 2099
    - path: src/model_card.py
      hash: md5
      md5: 8ac59dcd6704b997f27652fb1bc0e916
      size: 5064
    params:
      params.yaml:
        column_mapping.pos_label: phishing
        column_mapping.target: status
        data_test_pred: data/test_pred.csv
        data_train_pred: data/train_pred.csv
        feature_importance: results/feature_importance.yaml
        metrics: results/metrics.yaml
        model_card: results/models/model_card.png
    outs:
    - path: results/models/model_card.png
      hash: md5
      md5: a15592b71f6ff90f3074e666b38945b4
      size: 1141863
  model_card:
    cmd:
    - python src/model_card.py
    deps:
    - path: data/test_pred.csv
      hash: md5
      md5: cfea1064c4b01d66303795adeb32fe53
      size: 1310300
    - path: data/train_pred.csv
      hash: md5
      md5: 8a68d662b9c6a5b627872181dfc1ff57
      size: 2667246
    - path: results/feature_importance.yaml
      hash: md5
      md5: 4ade588766b0b45003518f1c7b21ab9a
      size: 2098
    - path: src/model_card.py
      hash: md5
      md5: 58d1505232c402d9b64ed57b45230c1a
      size: 5888
    - path: src/plots
      hash: md5
      md5: 4aedeef9c74ea2f50410dc83ed1f725c.dir
      size: 26430
      nfiles: 23
    params:
      params.yaml:
        column_mapping.pos_label: phishing
        column_mapping.target: status
        data_test_pred: data/test_pred.csv
        data_train_pred: data/train_pred.csv
        feature_importance: results/feature_importance.yaml
        metrics: results/metrics.yaml
        model_card: results/models/model_card.png
    outs:
    - path: results/models/model_card.png
      hash: md5
      md5: b6ba0e07e6e21f424a187e8971efbf60
      size: 1169354
  feature_importances:
    cmd:
    - python src/feature_importances.py
    deps:
    - path: data/test.csv
      hash: md5
      md5: 1ab33f0e67f2b269f66a241178d566b4
      size: 1201664
    - path: results/models/model.pkl
      hash: md5
      md5: f573844662e2c334fcbb0271490aa68e
      size: 33217493
    - path: results/selected_features.yaml
      hash: md5
      md5: f7caf56c01245c1940417a412e49689c
      size: 458
    - path: src/feature_importances.py
      hash: md5
      md5: 7c24bdf90970d417e03ae430483f1a8b
      size: 2080
    - path: src/plots/feature_importances.py
      hash: md5
      md5: b553c94b9be107402c0cd7216d90c58e
      size: 1523
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        path.data_test: data/test.csv
        path.data_train: data/train.csv
        path.feature_importances: results/plots/feature_importances.png
        path.model_bin: results/models/model.pkl
        path.selected_features: results/selected_features.yaml
        plt_style: Solarize_Light2
    outs:
    - path: results/plots/feature_importances.png
      hash: md5
      md5: 5e8f164d8fd85fee27cfac94f97ab4b9
      size: 57669
  feature_selection:
    cmd: python src/feature_selection.py
    deps:
    - path: data/raw
      hash: md5
      md5: 9fec2c93dc03b4ebb1fe4306dc1eecbb.dir
      size: 3648308
      nfiles: 2
    - path: src/feature_selection.py
      hash: md5
      md5: 6e848baa5946432fafeb90ec89793f5a
      size: 2323
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        feature_selection:
          _target_: sklearn.feature_selection.SelectKBest
          score_func:
            _target_: builtins.getattr
            _args_:
            - _target_: importlib.import_module
              name: sklearn.feature_selection
            - mutual_info_classif
          k: 10
        path.data.raw:
          dir: data/raw
          train: data/raw/train.csv
          test: data/raw/test.csv
        path.data.selected:
          dir: data/selected
          train: data/selected/train.csv
          test: data/selected/test.csv
        path.results.selected_features: results/selected_features.yaml
        plt_style: Solarize_Light2
    outs:
    - path: data/selected
      hash: md5
      md5: 6e0905ea6b999eac12432d9e93c3417d.dir
      size: 1557513
      nfiles: 2
    - path: results/selected_features.yaml
      hash: md5
      md5: d9f684dc4517215b90baf3f895ea606b
      size: 180
  test:
    cmd: python -c "print('${data}/all.csv')"
  model_interpretation:
    cmd:
    - python src/model_interpretation.py
    deps:
    - path: data/transformed
      hash: md5
      md5: d2d39cebe43b73eba4d1b815520f3f1b.dir
      size: 1466073
      nfiles: 2
    - path: results/models/classifier.pkl
      hash: md5
      md5: 304e6dcf867e41755067ad488aae46bd
      size: 32833776
    - path: src/model_interpretation.py
      hash: md5
      md5: bcf21b7cb41a8158f530459f4b4bff53
      size: 4253
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        path.data.transformed:
          dir: data/transformed
          train: data/transformed/train.csv
          test: data/transformed/test.csv
        path.results.models.classifier: results/models/classifier.pkl
        path.results.plots.feature_importances: results/plots/feature_importances.png
        plt_style: Solarize_Light2
    outs:
    - path: results/plots/feature_importances.png
      hash: md5
      md5: 065f31e3d5bda00566f26b866d82a960
      size: 25060
  preprocessing:
    cmd: python src/preprocessing.py
    deps:
    - path: data/raw
      hash: md5
      md5: 000b75bf48947366c86809a20fe811e5.dir
      size: 824540
      nfiles: 2
    - path: src/preprocessing.py
      hash: md5
      md5: 63ca53acaf19146fdba4439a80141bea
      size: 1727
    params:
      params.yaml:
        column_mapping:
          feature: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        path.data.raw:
          dir: data/raw
          train: data/raw/train.csv
          test: data/raw/test.csv
        path.results.models:
          dir: results/models
          label_encoder: results/models/label_encoder.pkl
          preprocessor: results/models/preprocessor.pkl
          classifier: results/models/classifier.pkl
        preprocessing:
          target:
            _target_: sklearn.preprocessing.LabelEncoder
          feature:
            _target_: sklearn.pipeline.make_union
            _args_:
            - _target_: sklearn.feature_extraction.text.TfidfVectorizer
              ngram_range:
                _target_: builtins.tuple
                _args_:
                - - 1
                  - 2
            - _target_: sklearn.feature_extraction.text.TfidfVectorizer
              analyzer: char
              ngram_range:
                _target_: builtins.tuple
                _args_:
                - - 1
                  - 4
    outs:
    - path: results/models/preprocessor.pkl
      hash: md5
      md5: 8d8536634de2db4ecd5ff15db78e7e9b
      size: 5798649
  analyze_data:
    cmd:
    - python src/analyze_data.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/analyze_data.py
      hash: md5
      md5: a67e66a4340ee57524751f3cb72f0a38
      size: 4651
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        feature_dtypes:
          ip: bool
          https_token: bool
          punycode: bool
          port: bool
          tld_in_path: bool
          tld_in_subdomain: bool
          abnormal_subdomain: bool
          prefix_suffix: bool
          random_domain: bool
          shortening_service: bool
          path_extension: bool
          domain_in_brand: bool
          brand_in_subdomain: bool
          brand_in_path: bool
          suspecious_tld: bool
          login_form: bool
          external_favicon: bool
          submit_email: bool
          sfh: bool
          iframe: bool
          popup_window: bool
          onmouseover: bool
          right_clic: bool
          empty_title: bool
          domain_in_title: bool
          domain_with_copyright: bool
          whois_registered_domain: bool
          dns_record: bool
          google_index: bool
        path.data.all: data/all.csv
        path.results.plots.correlation_matrix: results/plots/correlation_matrix.png
        path.results.plots.feature_statistics: results/plots/feature_statistics.pdf
        plt_style: Solarize_Light2
    outs:
    - path: results/plots/correlation_matrix.png
      hash: md5
      md5: 222b3f46665986358159b26533d5eea4
      size: 683184
    - path: results/plots/feature_statistics.pdf
      hash: md5
      md5: c62643401aa2bc3fc5cbfffdb2d434aa
      size: 274371
  finalize_model:
    cmd:
    - python src/finalize_model.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/finalize_model.py
      hash: md5
      md5: 2af5704a1462d5664c148db5f757b39d
      size: 1723
    params:
      params.yaml:
        classifier:
          estimator:
            _target_: sklearn.svm.LinearSVC
          cv: 5
          _target_: sklearn.calibration.CalibratedClassifierCV
          method: isotonic
        column_mapping:
          feature: url
          target: status
          pos_label: phishing
          prediction_label: prediction_label
          prediction_proba: prediction_proba
        path.data.all: data/all.csv
        path.final_models:
          dir: models
          onnx_model: models/model.onnx
          pkl_model: models/model.pkl
        preprocessing:
          target:
            _target_: sklearn.preprocessing.LabelEncoder
          feature:
            _target_: sklearn.pipeline.make_union
            _args_:
            - _target_: sklearn.feature_extraction.text.TfidfVectorizer
              ngram_range:
                _target_: builtins.tuple
                _args_:
                - - 2
                  - 2
    outs:
    - path: models
      hash: md5
      md5: f62deca132c6d7cc764923a138d4f831.dir
      size: 6977121
      nfiles: 2
