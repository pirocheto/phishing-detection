schema: '2.0'
stages:
  download_data:
    cmd: wget 
      https://raw.githubusercontent.com/pirocheto/dataset-registry/master/phishing-detection/data/dataset_B_05_2020.csv
      -O data/all.csv
    deps:
    - path: 
        https://raw.githubusercontent.com/pirocheto/dataset-registry/master/phishing-detection/data/dataset_B_05_2020.csv
      hash: md5
      checksum: '"6dbb847da1445c6e0bbdd4384878a6415cbeb462afe134c88ba4492e0e6c0c13"'
      size: 3661166
    params:
      params.yaml:
        data_url: 
          https://raw.githubusercontent.com/pirocheto/dataset-registry/master/phishing-detection/data/dataset_B_05_2020.csv
        path.data_all: data/all.csv
    outs:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
  report_data:
    cmd: python src/report_data.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/report_data.py
      hash: md5
      md5: 2d478369251db1be45153e2ebb8c8bd2
      size: 465
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        data_all: data/all.csv
        report_data_html: results/reports/data_report.html
    outs:
    - path: results/reports/data_report.html
      hash: md5
      md5: ccb49a64672738756090068cf4faa440
      size: 6170406
  split_data:
    cmd: python src/split_data.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/plots/data_proportion.py
      hash: md5
      md5: e397dab8f57cd0c878306b437518f519
      size: 1344
    - path: src/split_data.py
      hash: md5
      md5: 66e96ecf96ce8b3f96ddb10f378633ff
      size: 1001
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        path.data_all: data/all.csv
        path.data_proportion: results/plots/data_proportion.png
        path.data_test: data/test.csv
        path.data_train: data/train.csv
        plt_style: Solarize_Light2
        train_test_split:
          test_size: 0.33
          random_state: 42
          shuffle: true
    outs:
    - path: data/test.csv
      hash: md5
      md5: 1ab33f0e67f2b269f66a241178d566b4
      size: 1201664
    - path: data/train.csv
      hash: md5
      md5: de0274753f5d64f0729034afae01c814
      size: 2446644
    - path: results/plots/data_proportion.png
      hash: md5
      md5: 5c3dabd6fb800a9c8afb359cd87ceeb1
      size: 20130
  train_model:
    cmd: python src/train_model.py
    deps:
    - path: data/train.csv
      hash: md5
      md5: de0274753f5d64f0729034afae01c814
      size: 2446644
    - path: results/selected_features.yaml
      hash: md5
      md5: f7caf56c01245c1940417a412e49689c
      size: 458
    - path: src/train_model.py
      hash: md5
      md5: 40b3efac67c983f35bfc1dc6fa44e17c
      size: 1173
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        path.data_train: data/train.csv
        path.model_bin: results/models/model.pkl
        path.selected_features: results/selected_features.yaml
        pipeline:
          _target_: sklearn.pipeline.make_pipeline
          _args_:
          - _target_: sklearn.calibration.CalibratedClassifierCV
            method: isotonic
            cv: 5
            estimator:
              _target_: sklearn.ensemble.RandomForestClassifier
    outs:
    - path: results/models/model.pkl
      hash: md5
      md5: 16bebc7696e95616ab95253ecabccdf2
      size: 33064693
  test_model:
    cmd: python src/test_model.py
    deps:
    - path: data/test.csv
      hash: md5
      md5: 1ab33f0e67f2b269f66a241178d566b4
      size: 1201664
    - path: results/models/model.pkl
      hash: md5
      md5: 16bebc7696e95616ab95253ecabccdf2
      size: 33064693
    - path: results/selected_features.yaml
      hash: md5
      md5: f7caf56c01245c1940417a412e49689c
      size: 458
    - path: src/plots/calibration_curve.py
      hash: md5
      md5: f98337fcccca18db5d2d290147f49369
      size: 603
    - path: src/plots/confusion_matrix.py
      hash: md5
      md5: 2f148ca052d40ff673b31b60b26edbb4
      size: 1056
    - path: src/plots/cumulative_distribution.py
      hash: md5
      md5: d4a182dafa1bd35cb53a6096edc622ef
      size: 1954
    - path: src/plots/metrics_table.py
      hash: md5
      md5: ab081ba6afbdfb65e5b8a3cd31293040
      size: 909
    - path: src/plots/precision_recall_curve.py
      hash: md5
      md5: 7f32efebd4c770dea6338dfb8bcf8432
      size: 1805
    - path: src/plots/roc_curve.py
      hash: md5
      md5: b312a4443fa723ee6d97edc987ace79b
      size: 2029
    - path: src/plots/score_distribution.py
      hash: md5
      md5: 2c94d321a14aaf1f78d72599532154c6
      size: 1069
    - path: src/test_model.py
      hash: md5
      md5: 691d555e94405f6be3a0595455444ab7
      size: 4792
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        path.calibration_curve: results/plots/calibration_curve.png
        path.classification_report: results/plots/classification_report.png
        path.confusion_matrix: results/plots/confusion_matrix.png
        path.cumulative_distribution: results/plots/cumulative_distribution.png
        path.data_test: data/test.csv
        path.data_test_pred: data/test_pred.csv
        path.data_train: data/train.csv
        path.data_train_pred: data/train_pred.csv
        path.metrics: results/metrics.yaml
        path.metrics_table: results/plots/metrics_table.png
        path.model_bin: results/models/model.pkl
        path.precision_recall_curve: results/plots/precision_recall_curve.png
        path.roc_curve: results/plots/roc_curve.png
        path.score_distribution: results/plots/score_distribution.png
        path.selected_features: results/selected_features.yaml
        plt_style: Solarize_Light2
    outs:
    - path: data/test_pred.csv
      hash: md5
      md5: 671519063131294c0b6c66f29d215887
      size: 745530
    - path: data/train_pred.csv
      hash: md5
      md5: 5d9b472aff8872e97e50669579b0624e
      size: 1518709
    - path: results/metrics.yaml
      hash: md5
      md5: 049722f301104f0980d38e3cd782542b
      size: 115
    - path: results/plots/calibration_curve.png
      hash: md5
      md5: 88cdf61fed494cbf5cbe193bbf89a36f
      size: 29423
    - path: results/plots/classification_report.png
      hash: md5
      md5: 06c706f29768b25b5d0933e47c5e6ac6
      size: 418770
    - path: results/plots/confusion_matrix.png
      hash: md5
      md5: a09286fd876a027df89690b4cd074051
      size: 16808
    - path: results/plots/cumulative_distribution.png
      hash: md5
      md5: 5593100e5e3ebd845a23af8dcc9f44b5
      size: 36489
    - path: results/plots/metrics_table.png
      hash: md5
      md5: dad48e17b1ef47b351ffadb58659d7bb
      size: 13858
    - path: results/plots/precision_recall_curve.png
      hash: md5
      md5: f1e9fd8bde0864f68e1a16128028b6fd
      size: 21902
    - path: results/plots/roc_curve.png
      hash: md5
      md5: 9e5c5f8ea587cc7fc247cde09732b90c
      size: 34222
    - path: results/plots/score_distribution.png
      hash: md5
      md5: bb3c1ae53200f5bda34605c2e25ae984
      size: 20216
  dag:
    cmd: dvc dag --md > dag.md
  create_model_card:
    cmd:
    - python src/model_card.py
    deps:
    - path: data/test_pred.csv
      hash: md5
      md5: cfea1064c4b01d66303795adeb32fe53
      size: 1310300
    - path: data/train_pred.csv
      hash: md5
      md5: 8a68d662b9c6a5b627872181dfc1ff57
      size: 2667246
    - path: results/feature_importance.yaml
      hash: md5
      md5: fa7c581d0a8236870eafb42f3f781ec7
      size: 2099
    - path: src/model_card.py
      hash: md5
      md5: 8ac59dcd6704b997f27652fb1bc0e916
      size: 5064
    params:
      params.yaml:
        column_mapping.pos_label: phishing
        column_mapping.target: status
        data_test_pred: data/test_pred.csv
        data_train_pred: data/train_pred.csv
        feature_importance: results/feature_importance.yaml
        metrics: results/metrics.yaml
        model_card: results/models/model_card.png
    outs:
    - path: results/models/model_card.png
      hash: md5
      md5: a15592b71f6ff90f3074e666b38945b4
      size: 1141863
  model_card:
    cmd:
    - python src/model_card.py
    deps:
    - path: data/test_pred.csv
      hash: md5
      md5: cfea1064c4b01d66303795adeb32fe53
      size: 1310300
    - path: data/train_pred.csv
      hash: md5
      md5: 8a68d662b9c6a5b627872181dfc1ff57
      size: 2667246
    - path: results/feature_importance.yaml
      hash: md5
      md5: 4ade588766b0b45003518f1c7b21ab9a
      size: 2098
    - path: src/model_card.py
      hash: md5
      md5: 58d1505232c402d9b64ed57b45230c1a
      size: 5888
    - path: src/plots
      hash: md5
      md5: 4aedeef9c74ea2f50410dc83ed1f725c.dir
      size: 26430
      nfiles: 23
    params:
      params.yaml:
        column_mapping.pos_label: phishing
        column_mapping.target: status
        data_test_pred: data/test_pred.csv
        data_train_pred: data/train_pred.csv
        feature_importance: results/feature_importance.yaml
        metrics: results/metrics.yaml
        model_card: results/models/model_card.png
    outs:
    - path: results/models/model_card.png
      hash: md5
      md5: b6ba0e07e6e21f424a187e8971efbf60
      size: 1169354
  feature_importances:
    cmd:
    - python src/feature_importances.py
    deps:
    - path: data/test.csv
      hash: md5
      md5: 1ab33f0e67f2b269f66a241178d566b4
      size: 1201664
    - path: results/models/model.pkl
      hash: md5
      md5: 16bebc7696e95616ab95253ecabccdf2
      size: 33064693
    - path: results/selected_features.yaml
      hash: md5
      md5: f7caf56c01245c1940417a412e49689c
      size: 458
    - path: src/feature_importances.py
      hash: md5
      md5: bbe15d4566957f8e931a1a81f67ba81d
      size: 2091
    - path: src/plots/feature_importances.py
      hash: md5
      md5: b553c94b9be107402c0cd7216d90c58e
      size: 1523
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        path.data_test: data/test.csv
        path.data_train: data/train.csv
        path.feature_importances: results/plots/feature_importances.png
        path.model_bin: results/models/model.pkl
        path.selected_features: results/selected_features.yaml
        plt_style: Solarize_Light2
    outs:
    - path: results/plots/feature_importances.png
      hash: md5
      md5: f670bc6035fbec3507a61f028dbbc8ce
      size: 57607
  feature_selection:
    cmd: python src/feature_selection.py
    deps:
    - path: data/all.csv
      hash: md5
      md5: ed9850d990e6aa169afcd23497397fcd
      size: 3661166
    - path: src/feature_selection.py
      hash: md5
      md5: 3b79f89d6af79bed13ad23a7dc2e08f3
      size: 2087
    - path: src/plots/correlation_matrix.py
      hash: md5
      md5: c31b6d4cdb079375513ffb67ef344a60
      size: 1518
    params:
      params.yaml:
        column_mapping:
          id: url
          target: status
          pos_label: phishing
          prediction: phishing
        feature_selection:
          _target_: sklearn.feature_selection.VarianceThreshold
          threshold: 1
        path.correlation_matrix: results/plots/correlation_matrix.png
        path.data_all: data/all.csv
        path.data_test: data/test.csv
        path.data_train: data/train.csv
        path.selected_features: results/selected_features.yaml
        plt_style: Solarize_Light2
    outs:
    - path: results/plots/correlation_matrix.png
      hash: md5
      md5: d5ec874d8e1c776cfb2896c6ffbfe5d6
      size: 214821
    - path: results/selected_features.yaml
      hash: md5
      md5: f7caf56c01245c1940417a412e49689c
      size: 458
